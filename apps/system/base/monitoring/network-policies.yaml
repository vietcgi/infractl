apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: monitoring
  namespace: monitoring
  labels:
    app.kubernetes.io/part-of: monitoring
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress

  # Allow Prometheus scraping
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app.kubernetes.io/name: prometheus-operator
    ports:
    - protocol: TCP
      port: 9090  # Prometheus
    - protocol: TCP
      port: 9100  # node-exporter
    - protocol: TCP
      port: 10250 # kubelet metrics
    - protocol: TCP
      port: 10255 # kubelet read-only port

  # Allow Grafana access
  - from:
    - namespaceSelector: {}
      podSelector:
        matchLabels:
          app.kubernetes.io/name: grafana
    ports:
    - protocol: TCP
      port: 3000

  # Allow Alertmanager API access
  - from:
    - podSelector:
        matchLabels:
          app.kubernetes.io/name: alertmanager
    ports:
    - protocol: TCP
      port: 9093
    - protocol: TCP
      port: 9094  # cluster communication

  # Allow all egress traffic
  egress: [{}]

---
# Label the monitoring namespace
apiVersion: v1
kind: Namespace
metadata:
  name: monitoring
  labels:
    kubernetes.io/metadata.name: monitoring
